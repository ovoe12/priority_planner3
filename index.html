<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ìš°ì„  ìˆœìœ„ í”Œë˜ë„ˆ</title>
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    input, select { margin: 5px; }
    .task { margin-top: 10px; padding: 10px; border: 1px solid #ccc; border-radius: 8px; }
    .high { background-color: #ffe0e0; }
    .medium { background-color: #fff0cc; }
    .low { background-color: #e0ffe0; }
    #calendar { max-width: 900px; margin-top: 30px; }
  </style>
</head>
<body>
  <h2>ğŸ“ ìš°ì„ ìˆœìœ„ í”Œë˜ë„ˆ</h2>
  <p>ì¹´í…Œê³ ë¦¬ë³„ ì ìˆ˜: ê³¼ì œ/ì•½ì†: 10ì , ì‹œí—˜ê³µë¶€: 9ì , ê³µë¶€/í–‰ì‚¬: 8ì <br>
     ë§ˆê° ì ìˆ˜ = 10 - ë‚¨ì€ë‚  + 1 (10ì¼ ì´ˆê³¼ì‹œ 1ì )<br>
     ë‚œì´ë„ëŠ” 1~10 ì§ì ‘ ì…ë ¥</p>

  <input type="text" id="name" placeholder="í•  ì¼ ì´ë¦„">
  <select id="category">
    <option value="0">ê³¼ì œ</option>
    <option value="1">ì•½ì†</option>
    <option value="2">ì‹œí—˜ê³µë¶€</option>
    <option value="3">ê³µë¶€</option>
    <option value="4">í–‰ì‚¬</option>
  </select>
  <input type="number" id="days" min="0" max="30" placeholder="ë‚¨ì€ ë‚ ">
  <input type="number" id="hard" min="1" max="10" placeholder="ë‚œì´ë„">
  <button onclick="addTask()">ì¶”ê°€í•˜ê¸°</button>
  <hr>
  <div id="taskList"></div>

  <h3>ğŸ“… ì¼ì • ë‹¬ë ¥</h3>
  <div id="calendar"></div>

  <script>
    const categoryMap = ["ê³¼ì œ", "ì•½ì†", "ì‹œí—˜ê³µë¶€", "ê³µë¶€", "í–‰ì‚¬"];
    let tasks = JSON.parse(localStorage.getItem("tasks") || "[]");
    let calendar;

    function calcScore(cat, days, hard) {
      let score = 0;
      score += (cat === 0 || cat === 1) ? 10 : (cat === 2 ? 9 : 8);
      score += (days <= 10) ? (10 - days + 1) : 1;
      score += hard;
      return score;
    }

    function addTask() {
      const name = document.getElementById("name").value.trim();
      const category = parseInt(document.getElementById("category").value);
      const days = parseInt(document.getElementById("days").value);
      const hard = parseInt(document.getElementById("hard").value);

      if (!name || isNaN(days) || isNaN(hard)) {
        alert("ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
        return;
      }

      const score = calcScore(category, days, hard);
      tasks.push({ name, category, days, hard, score });
      saveAndRender();
      clearInputs();
    }

    function deleteTask(index) {
      tasks.splice(index, 1);
      saveAndRender();
    }

    function saveAndRender() {
      localStorage.setItem("tasks", JSON.stringify(tasks));
      renderTasks();
      renderCalendar();
    }

    function clearInputs() {
      document.getElementById("name").value = '';
      document.getElementById("days").value = '';
      document.getElementById("hard").value = '';
    }

    function renderTasks() {
      const list = document.getElementById("taskList");
      list.innerHTML = '';
      const sorted = tasks.slice().sort((a, b) => b.score - a.score);
      sorted.forEach(task => {
        const div = document.createElement("div");
        div.className = "task " + (task.score >= 25 ? 'high' : task.score >= 20 ? 'medium' : 'low');
        div.innerHTML = `
          <strong>${task.name}</strong> (${categoryMap[task.category]})<br>
          ë‚¨ì€ ë‚ : ${task.days}, ë‚œì´ë„: ${task.hard}, ì ìˆ˜: ${task.score}
          <br><button onclick="deleteTask(${tasks.indexOf(task)})">ì‚­ì œ</button>
        `;
        list.appendChild(div);
      });
    }

    function renderCalendar() {
      const events = tasks.map(task => {
        // ì˜¤ëŠ˜ ë‚ ì§œì— ë‚¨ì€ ë‚ ì„ ë”í•´ ì¼ì • ë‚ ì§œ ê³„ì‚°
        const date = new Date();
        date.setDate(date.getDate() + task.days);
        const yyyy = date.getFullYear();
        const mm = String(date.getMonth() + 1).padStart(2, '0');
        const dd = String(date.getDate()).padStart(2, '0');
        const dateStr = `${yyyy}-${mm}-${dd}`;

        return {
          title: `${task.name} (${categoryMap[task.category]})`,
          start: dateStr,
          color: task.score >= 25 ? '#ff9999' : task.score >= 20 ? '#ffd966' : '#b6f7b0'
        };
      });

      if (!calendar) {
        calendar = new FullCalendar.Calendar(document.getElementById('calendar'), {
          initialView: 'dayGridMonth',
          locale: 'ko',
          events: events,
          eventClick: info => {
            alert(`ğŸ“Œ ${info.event.title}\nì¼ì • ë‚ ì§œ: ${info.event.start.toLocaleDateString()}`);
          }
        });
        calendar.render();
      } else {
        calendar.removeAllEvents();
        calendar.addEventSource(events);
      }
    }

    saveAndRender();
  </script>
</body>
</html>
